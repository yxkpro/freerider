/*
 * XenForo discussion.min.js
 * Copyright 2010-2014 XenForo Ltd.
 * Released under the XenForo License Agreement: http://xenforo.com/license-agreement
 */
(function(b,g,h){XenForo.QuickReply=function(a){if(b("#messageList").length==0)return console.error("Quick Reply not possible for %o, no #messageList found.",a);var c=b('input[name="last_date"]',a);c.data("load-value")&&c.val(Math.max(c.val(),c.data("load-value")));var e=XenForo.MultiSubmitFix(a);this.scrollAndFocus=function(){b(h).scrollTop(a.offset().top);var d=XenForo.getEditorInForm(a);if(!d)return!1;d.$editor?d.focus(!0):d.focus();return this};a.data("QuickReply",this).bind({AutoValidationBeforeSubmit:function(a){if(b(a.clickedSubmitButton).is('input[name="more_options"]'))a.preventDefault(),
a.returnValue=!0},AutoValidationComplete:function(d){if(d.ajaxData._redirectTarget)g.location=d.ajaxData._redirectTarget;b('input[name="last_date"]',a).val(d.ajaxData.lastDate);e&&e();a.find("input:submit").blur();new XenForo.ExtLoader(d.ajaxData,function(){b("#messageList").find(".messagesSinceReplyingNotice").remove();b(d.ajaxData.templateHtml).each(function(){this.tagName&&b(this).xfInsert("appendTo",b("#messageList"))})});var c=b("#QuickReply").find("textarea");c.val("");(c=c.data("XenForo.BbCodeWysiwygEditor"))&&
c.resetEditor();a.trigger("QuickReplyComplete");return!1},BbCodeWysiwygEditorAutoSaveComplete:function(a){var c=b("#messageList"),e=c.find(".messagesSinceReplyingNotice");a.ajaxData.newPostCount&&a.ajaxData.templateHtml?e.length?(e.remove(),b(a.ajaxData.templateHtml).appendTo(c).show().xfActivate()):b(a.ajaxData.templateHtml).xfInsert("appendTo",c):e.remove()}})};XenForo.QuickReplyTrigger=function(a){a.click(function(){console.info("Quick Reply Trigger Click");var c=null,e=null,d=null;a.is(".MultiQuote")?
(c=b(a.data("form")),d={postIds:b(a.data("inputs")).map(function(){return this.value}).get()}):(c=b("#QuickReply"),c.data("QuickReply").scrollAndFocus());e||(e=XenForo.ajax(a.data("posturl")||a.attr("href"),d,function(d){if(XenForo.hasResponseError(d))return!1;delete e;var b=XenForo.getEditorInForm(c);if(!b)return!1;b.$editor?(b.insertHtml(d.quoteHtml),b.$editor.data("xenForoElastic")&&b.$editor.data("xenForoElastic")()):b.val(b.val()+d.quote);a.is(".MultiQuote")&&c.trigger("MultiQuoteComplete")}));
return!1})};XenForo.InlineMessageEditor=function(a){new XenForo.MultiSubmitFix(a);a.bind({AutoValidationBeforeSubmit:function(a){if(b(a.clickedSubmitButton).is('input[name="more_options"]'))a.preventDefault(),a.returnValue=!0},AutoValidationComplete:function(c){var b=a.closest("div.xenOverlay").data("overlay");b.getTrigger().data("target");XenForo.hasTemplateHtml(c.ajaxData,"messagesTemplateHtml")||XenForo.hasTemplateHtml(c.ajaxData)?(c.preventDefault(),b.close().getTrigger().data("XenForo.OverlayTrigger").deCache(),
XenForo.showMessages(c.ajaxData,b.getTrigger(),"instant")):console.warn("No template HTML!")}})};XenForo.NewMessageLoader=function(a){a.click(function(c){c.preventDefault();XenForo.ajax(a.data("href")||a.attr("href"),{},function(a){if(XenForo.hasResponseError(a))return!1;var c=b("#QuickReply"),f=b("#messageList");b('input[name="last_date"]',c).val(a.lastDate);new XenForo.ExtLoader(a,function(){f.find(".messagesSinceReplyingNotice").remove();b(a.templateHtml).each(function(){this.tagName&&b(this).xfInsert("appendTo",
f)})})})})};XenForo.MessageLoader=function(a){a.click(function(c){c.preventDefault();var e=[];b(a.data("messageselector")).each(function(a,b){e.push(b.id)});e.length?XenForo.ajax(a.attr("href"),{messageIds:e},function(b){XenForo.showMessages(b,a,"fadeDown")}):console.warn("No messages found to load.")})};XenForo.showMessages=function(a,c,e){var d=function(a,c){switch(e){case "instant":e={show:"xfShow",hide:"xfHide",speed:0};break;case "fadeIn":e={show:"xfFadeIn",hide:"xfFadeOut",speed:XenForo.speed.fast};
break;default:e={show:"xfFadeDown",hide:"xfFadeUp",speed:XenForo.speed.normal}}b(a)[e.hide](e.speed/2,function(){b(c).xfInsert("replaceAll",a,e.show,e.speed)})};if(XenForo.hasResponseError(a))return!1;XenForo.hasTemplateHtml(a,"messagesTemplateHtml")?new XenForo.ExtLoader(a,function(){b.each(a.messagesTemplateHtml,d)}):XenForo.hasTemplateHtml(a)&&new XenForo.ExtLoader(a,function(){d(c.data("messageselector"),a.templateHtml)})};XenForo.PollVoteForm=function(a){a.bind("AutoValidationComplete",function(c){c.preventDefault();
if(XenForo.hasTemplateHtml(c.ajaxData)){var e=b(a.data("container"));a.xfFadeUp(XenForo.speed.normal,function(){a.empty().remove();var d=b(c.ajaxData.templateHtml);d.is(a.data("container"))?d=d.children():d.find(a.data("container")).length&&(d=d.find(a.data("container")));d.xfInsert("appendTo",e)},XenForo.speed.normal,"swing")}})};XenForo.MultiQuote=function(a){this.__construct(a)};XenForo.MultiQuote.prototype={__construct:function(a){this.$button=a;this.$form=a.closest("form");this.cookieName=a.data("mq-cookie")||
"MultiQuote";this.cookieValue=[];this.submitUrl=a.data("submiturl");this.$controls=new jQuery;this.getCookieValue();this.setButtonState();var c=this;this.$form.bind("MultiQuoteComplete",b.context(this,"reset"));this.$form.bind("MultiQuoteRemove MultiQuoteAdd",function(a,b){b&&b.messageId&&c.toggleControl(b.messageId,a.type=="MultiQuoteAdd")})},getCookieValue:function(){var a=b.getCookie(this.cookieName);this.cookieValue=a==null?[]:a.split(",")},setButtonState:function(){this.getCookieValue();this.cookieValue.length?
this.$button.show():this.$button.hide()},addControl:function(a){a.click(b.context(this,"clickControl"));this.getCookieValue();this.setControlState(a,b.inArray(a.data("messageid")+"",this.cookieValue)>=0,!0);this.$controls=this.$controls.add(a)},setControls:function(){var a=this;a.getCookieValue();this.$controls.each(function(){a.setControlState(b(this),b.inArray(b(this).data("messageid")+"",a.cookieValue)>=0)})},setControlState:function(a,b,e){var d;d=this.$button;var f;b?(d=d.data("remove")||"-",
f=!0):(d=d.data("add")||"+",f=!1);(!e||a.hasClass("active")!==f)&&a.toggleClass("active",b).find("span.symbol").text(d)},clickControl:function(a){a.preventDefault();var a=b(a.target).closest("a.MultiQuoteControl"),c=!a.is(".active"),e=this.$button.data(c?"add-message":"remove-message");this.toggleControl(a.data("messageid"),c);e&&XenForo.alert(e,"",2E3)},toggleControl:function(a,c){this.getCookieValue();a+="";var e=b.inArray(a,this.cookieValue),d;d=this.$controls.filter(function(){return b(this).data("messageid")==
a}).first();c?(d.length&&this.setControlState(d,!0),e<0&&this.cookieValue.push(a)):(d.length&&this.setControlState(d,!1),e>=0&&this.cookieValue.splice(e,1));this.cookieValue.length>0?b.setCookie(this.cookieName,this.cookieValue.join(",")):b.deleteCookie(this.cookieName);this.setButtonState()},reset:function(){b.deleteCookie(this.cookieName);this.cookieValue=[];this.setControls();this.setButtonState()}};XenForo.MultiQuoteControl=function(a){var c=a.data("mq-target")||"#MultiQuote";(c=b(c).data("XenForo.MultiQuote"))&&
c.addControl(a)};XenForo.MultiQuoteRemove=function(a){a.click(function(){var c=a.closest(".MultiQuoteItem"),e=c.find(".MultiQuoteId").val(),d=b(b("#MultiQuoteForm").data("form")),f=a.closest(".xenOverlay");e&&d.trigger("MultiQuoteRemove",{messageId:e});c.remove();f.length&&!f.find(".MultiQuoteItem").length&&f.overlay().close()})};XenForo.MultiQuoteInsert=function(a){a.click(function(){var c=b(a.data("form")),e=null,e=XenForo.ajax(a.attr("href"),{postIds:b(a.data("inputs")).map(function(){return this.value}).get()},
function(b){if(XenForo.hasResponseError(b))return!1;delete e;var f=XenForo.getEditorInForm(c);if(!f)return!1;f.$editor?(f.insertHtml(b.quoteHtml),f.$editor.data("xenForoElastic")&&f.$editor.data("xenForoElastic")()):f.val(f.val()+b.quote);a.is(".MultiQuote")&&c.trigger("MultiQuoteComplete")});return!1})};XenForo.Sortable=function(a){a.sortable({forcePlaceholderSize:!0}).bind({sortupdate:function(){},dragstart:function(a){console.log("drag start, %o",a.target)},dragend:function(){console.log("drag end")}})};
XenForo.register("#QuickReply","XenForo.QuickReply");XenForo.register("a.ReplyQuote, a.MultiQuote","XenForo.QuickReplyTrigger");XenForo.register("form.InlineMessageEditor","XenForo.InlineMessageEditor");XenForo.register("a.MessageLoader","XenForo.MessageLoader");XenForo.register("a.NewMessageLoader","XenForo.NewMessageLoader");XenForo.register("form.PollVoteForm","XenForo.PollVoteForm");XenForo.register(".MultiQuoteWatcher","XenForo.MultiQuote");XenForo.register("a.MultiQuoteControl","XenForo.MultiQuoteControl");
XenForo.register("a.MultiQuoteRemove","XenForo.MultiQuoteRemove");XenForo.register(".Sortable","XenForo.Sortable")})(jQuery,this,document);
